<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack高级 | 个人学习博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/personal_learning_blog/logo.png">
    <link rel="manifest" href="/personal_learning_blog/manifest.json">
    <link rel="apple-touch-icon" href="/personal_learning_blog/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/personal_learning_blog/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="个人学习博客">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/personal_learning_blog/assets/css/0.styles.d89bb2b8.css" as="style"><link rel="preload" href="/personal_learning_blog/assets/js/app.74e3015b.js" as="script"><link rel="preload" href="/personal_learning_blog/assets/js/2.6c17bd23.js" as="script"><link rel="preload" href="/personal_learning_blog/assets/js/89.86e0154c.js" as="script"><link rel="prefetch" href="/personal_learning_blog/assets/js/10.f3dfdda0.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/100.6fe8a05c.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/101.62fa532d.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/102.2b529457.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/103.2096c698.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/104.3d417a3f.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/105.dd8445dd.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/106.21732a46.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/107.190b9142.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/108.12c56ec1.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/11.15e025ca.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/12.3c465d6f.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/13.01fa0ab2.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/14.228b20df.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/15.e051af75.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/16.b6cd45b2.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/17.04b92cfa.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/18.f213c6d2.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/19.731e1965.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/20.37dd4851.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/21.4539f92b.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/22.ff177489.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/23.337464b7.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/24.c615303b.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/25.6a702dd7.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/26.0c25b06b.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/27.36993a49.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/28.ff6e6e2f.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/29.687807da.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/3.81a0a7fb.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/30.c6db1f4d.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/31.2342ba6a.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/32.8198781b.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/33.b238ec12.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/34.69e7f1b8.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/35.5a58ffe8.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/36.c925e579.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/37.cba0c296.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/38.3438e861.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/39.bdeebabe.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/4.ba3164ba.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/40.5264cfc2.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/41.7a3922a5.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/42.f93f3c7f.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/43.9cb47d07.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/44.14da4196.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/45.d58f54ea.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/46.605c4244.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/47.f81de92d.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/48.c24766f9.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/49.e0e93f9a.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/5.75a3592b.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/50.c37731f2.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/51.5daa5256.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/52.9901f9c7.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/53.7488a95a.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/54.96d1df40.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/55.f40beac1.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/56.596340de.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/57.796601c5.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/58.879319ae.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/59.4ca05c3d.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/6.0377ba0c.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/60.a7c4a633.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/61.9c4a99c3.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/62.a46d12fe.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/63.108ac59f.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/64.18e7e87f.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/65.ff114422.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/66.8d316103.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/67.09533e88.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/68.37810e5e.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/69.71fadcfc.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/7.c5829170.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/70.76b6f674.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/71.2ba4e8cd.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/72.4f5b9f9b.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/73.81464a39.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/74.66c11559.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/75.d5e0ec17.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/76.4a1d1e39.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/77.a29f54e9.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/78.2a8dd139.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/79.ab2d8390.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/8.08326ec3.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/80.a905e17b.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/81.976246d0.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/82.43e2d4f4.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/83.e0dce43e.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/84.fba59f59.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/85.ee892391.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/86.78db9fc4.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/87.b48f406e.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/88.75767c0b.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/9.28a7790b.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/90.db1e0351.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/91.c39dcc6c.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/92.300d0ab2.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/93.793d24d5.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/94.a43aed3f.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/95.7d193dca.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/96.67e5317e.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/97.8e7acaca.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/98.79f74317.js"><link rel="prefetch" href="/personal_learning_blog/assets/js/99.f82e0052.js">
    <link rel="stylesheet" href="/personal_learning_blog/assets/css/0.styles.d89bb2b8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/personal_learning_blog/" class="home-link router-link-active"><!----> <span class="site-name">个人学习博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/sunnyzlx/personal_learning_blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/sunnyzlx/personal_learning_blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>es5</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>es6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>wechat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/personal_learning_blog/webpack/" aria-current="page" class="sidebar-link">webpack4简介</a></li><li><a href="/personal_learning_blog/webpack/webpack基础.html" class="sidebar-link">webpack基础</a></li><li><a href="/personal_learning_blog/webpack/webpack进阶.html" class="sidebar-link">webpack进阶</a></li><li><a href="/personal_learning_blog/webpack/webpack高级.html" class="active sidebar-link">webpack高级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/personal_learning_blog/webpack/webpack高级.html#treeshaking" class="sidebar-link">TreeShaking</a></li><li class="sidebar-sub-header"><a href="/personal_learning_blog/webpack/webpack高级.html#develoment-和-production-模式的区分打包" class="sidebar-link">Develoment 和 Production 模式的区分打包</a></li><li class="sidebar-sub-header"><a href="/personal_learning_blog/webpack/webpack高级.html#webpack-和-code-splitting-代码分隔" class="sidebar-link">Webpack 和 Code Splitting(代码分隔)</a></li></ul></li><li><a href="/personal_learning_blog/webpack/webpack实战.html" class="sidebar-link">webpack实战</a></li><li><a href="/personal_learning_blog/webpack/webpack性能优化.html" class="sidebar-link">webpack性能优化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>leetcode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>work</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>interview</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack高级"><a href="#webpack高级" class="header-anchor">#</a> webpack高级</h1> <h2 id="treeshaking"><a href="#treeshaking" class="header-anchor">#</a> TreeShaking</h2> <ul><li>tree shaking 只支持ES Module的模块引入方式，ta 的底层是一个静态引入的方式，而commonjs底层是一个动态引入的方式，tree shaking只支持静态引入的方式</li> <li>使用方式：
<ul><li>在开发环境中, 一般tree shaking不会生效，不会删除无用代码，只会提示一下，这是为了方便sourceMap纠错调试</li></ul> <div class="language- extra-class"><pre class="language-text"><code>optimization:{
  usedExports: true
}
在package.json中添加：
sideEffects: false //对所有文件都进行tree shaking ,没有需要特殊处理的模块
// 一般会设置 sideEffects: [&quot;*.css&quot;, &quot;@babel/polyfill&quot;]
</code></pre></div><ul><li>在生产环境中，tree shaking 是会生效的，会剔除无用代码，且只需要设置sideEffects，内置优化中已经优化 了optimization</li></ul></li> <li>@babel/polyfill并没有向代码中导入任何的内容，而是在window对象上挂载了一些全局变量，如Promise， Window.Promise</li></ul> <h2 id="develoment-和-production-模式的区分打包"><a href="#develoment-和-production-模式的区分打包" class="header-anchor">#</a> Develoment 和 Production 模式的区分打包</h2> <ul><li>开发环境需要强大的 source map 和一个有着 live reloading(实时重新加载) 或 hot module replacement(热模块替换) 能力的 localhost server，线上环境需要对代码进行压缩，对SourceMap进行精简, 资源优化等，通过这些优化方式改善加载时间</li> <li>通过第三方模块webpack-merge将公共配置与当前配置进行合并</li></ul> <h2 id="webpack-和-code-splitting-代码分隔"><a href="#webpack-和-code-splitting-代码分隔" class="header-anchor">#</a> Webpack 和 Code Splitting(代码分隔)</h2> <ul><li>代码分隔，与webpack无关，只是现在webpack实现这个功能实现的比较好</li> <li>webpack中实现代码分隔，两种方式：
<ul><li>同步代码，只需在webpack.common.js中做optimization配置即可</li></ul> <div class="language- extra-class"><pre class="language-text"><code>optimization: {
  splitChunks:{
    chunks: 'all'
  }
}
</code></pre></div><ul><li>异步代码：使用import()语法异步加载的代码，无需做任何配置，会自动进行代码分隔</li></ul></li> <li>SplitChunksPlugin配置参数详解
<ul><li>魔法注释： import(/* webpackChunkName: &quot;lodash&quot; */ 'lodash')</li></ul> <div class="language- extra-class"><pre class="language-text"><code>function getComponent() {
</code></pre></div></li></ul> <ul><li>return import(/* webpackChunkName: &quot;lodash&quot; */ 'lodash').then(({ default: _ }) =&gt; {</li> <li><div class="language- extra-class"><pre><code>var element = document.createElement('div');
</code></pre></div></li> <li></li> <li><div class="language- extra-class"><pre><code>element.innerHTML = _.join(['Hello', 'webpack'], ' ');
</code></pre></div></li> <li></li> <li><div class="language- extra-class"><pre><code>return element;
</code></pre></div></li> <li></li> <li>}).catch(error =&gt; 'An error occurred while loading the component');
}</li></ul> <div class="language- extra-class"><pre class="language-text"><code></code></pre></div><p>optimization: {
splitChunks: {
chunks: 'async', // async只对异步代码做分隔，initial只对同步代码做分隔，all同步异步都可，此外，打包同步代码，还会走cacheGroups，再具体配置
minSize: 30000, //大于30kb的模块才做代码分隔
maxSize: 0, //当代码分隔后生成的模块体积大于maxSize时，会进行二次分隔，进行更细粒度的分隔
minChunks: 1, //当某个模块被使用多少次后，才对它进行代码分隔
maxAsyncRequests: 5,
maxInitialRequests: 3,
automaticNameDelimiter: '~',
name: true,
cacheGroups: {
vendors: { // vendors-main.js 该同步代码属于vendors组，且打包的入口文件是main.js
test: /[\/]node_modules[\/]/, //同步代码的存放是否在node_modules中
priority: -10,
filename: 'vendors.js' // 命名代码分隔后生成的模块名字
},
default: { //同步代码分隔，不属于vendors组时，会走default组，
minChunks: 2,
priority: -20,
reuseExistingChunk: true,
filename: 'common.js' //default组也可以重命名
// default-main.js 该同步代码属于default组，且打包的入口文件是main.js
}
}
}
}</p> <div class="language- extra-class"><pre class="language-text"><code>## Lazy Loading 懒加载，Chunk是什么？
- 懒加载，使用import()语法懒加载模块，在页面需要大时候，再去加载，不需要的时候就不加载，这样可以提高加载性能
- Chunk，打包完成之后，dist文件夹下有几个js文件，就是有几个chunk
## 打包分析，Preloading, Prefetching
-  打包分析
- 在打包命令中加入 --profile --json &gt; stats.json，生成一个对打包过程的描述文件 stats.json
- 生成分析文件之后，借助工具来分析打包过程的分析
- 可以帮助我们分析打包生成代码之间的一些依赖关系，当我们做复杂项目的代码打包时，有时代码分隔出的代码形式不是很符合我们的预期，我们可以借助代码分析工具来分析，看看是不是有些代码重复打包？有些代码打包可以优化？有些代码打包比较耗时？ 
- Preloading, Prefetching
</code></pre></div><p>optimization{
splitChunks:{
chunks: 'all' //我们配置的代码分隔，是对同步和异步代码都分离
// webpack默认只对异步代码做分离
}
}</p> <div class="language- extra-class"><pre class="language-text"><code> - webpack默认只对异步代码做分隔，原因？
   -  因为对同步代码做完分隔后，第一次访问时加载代码，第二次加载时使用缓存，提高访问速度，但这样做只不过是提高来第二次访问页面时的加载速度，而真正对页面性能做优化，webapck希望的是，当你第一次加载页面时，它的加载速度就是最快的，所以对同步代码做分隔，根本达不到你的需求
   - 代码分析， c+shift+p 打开show coverage,做屏幕录制来分析
   - webpack真正希望我们编写代码的方式是，希望将需要交互的代码，放到异步加载的模块中去写使用import()，再用到代码时再去加载它，提高页面首次加载时的代码利用率，才是提升页面首次加载性能的关键，而非使用缓存，缓存只能提高页面第二次打开时的加载性能
   - 所以webpack希望我们编写代码时，尽可能的多写异步加载的代码，提高页面首次加载时的代码利用率，而同步代码对提升页面首次加载的性能意义并不大，只对缓存有益处,对性能提升非常有限
 - 项目中真正可以应用异步代码的典型场景：
   -  在点击登录时，会显示一个登录框，在加载首页时，登录框的代码就不应该被加载，在点击时在加载比较好，但这样又会造成点击时的用户交互很慢，所以我们可以在访问首页时，只加载首页内容，不加载登录框的代码逻辑，等到首页加载完成，带宽释放出来，网络空闲时，再去偷偷将登录框的代码逻辑下载下来，这样点击时就不会存在交互慢的问题了，这样做既解决了首页核心代码加载非常快的一个要求，又解决了点击登录框展示非常快的一个要求 
   - Prefetching会等到页面核心代码加载完成，网络空闲时加载
   - import(/* webpackPrefetch: true */ 'LoginModal');
   - Preloading会和页面核心代码一起并行加载 
   - import(/* webpackPreload: true */ 'ChartingLibrary');
   - 所以代码的最优编程应该是使用Prefetch，等到页面核心代码加载完成之后，网络空闲时，再去加载这些需要懒加载的js文件，这样才是webpack推荐的最优的编码方式，
   - 要想提高页面性能，不应该去关注缓存，因为缓存能带来的性能提升实在有限，而应该去重点关注页面加载的js文件的代码利用率，有一些交互之后才能利用到的代码，完全可以放到异步组件中，通过懒加载的方式加载，这样就可以使你的页面性能得到非常大的提升，页面访问速度变得非常的快，但🈶️觉得懒加载可能会牺牲一些用户体验，这时就可以利用Prefetch来做，但Prefetch在某些浏览器上可能会一些兼容性问题，使用时要注意
   - 重点：在做前端性能优化时，缓存其实并不是最重要的点，最重要的点是代码利用率
   ## CSS文件的代码分隔
   -  output -&gt; chunkFilename: '[name].bundle.js', 决定 non-entry chunk(非主入口 chunk) 的名称
   -  webpack做打包时，默认会将CSS文件打包进JS中，即css in js
   -  mini-css-extract-plugin 插件会将css文件单独打包生成一个css文件，而不是打包进js中
   -  在开发环境中使用时，不支持模块热更新，导致开发效率不高，所以只在生产环境中使用它
   -  在项目中使用css时，使用import './style.css',要谨防css文件被tree shaking删除,需要在package.json中配置sideEffects: [&quot;*.css&quot;]
   - 使用：
</code></pre></div><p>npm install --save-dev mini-css-extract-plugin
const MiniCssExtractPlugin = require(&quot;mini-css-extract-plugin&quot;);
module.exports = {
plugins: [
new MiniCssExtractPlugin({
// Options similar to the same options in webpackOptions.output
// both options are optional
filename: &quot;[name].css&quot;, //直接被引入到html文件中会走filename
chunkFilename: &quot;[id].css&quot; //间接被引入html文件会走chunkFilename
})
],
module: {
rules: [
{
test: /.css$/,
use: [
{
loader: MiniCssExtractPlugin.loader,
options: {
// you can specify a publicPath here
// by default it use publicPath in webpackOptions.output
publicPath: '../'
}
},
&quot;css-loader&quot;
]
}
]
}
}</p> <div class="language- extra-class"><pre class="language-text"><code>- optimize-css-assets-webpack-plugin 打包分离出的css文件，默认未压缩，要想压缩合并，使用该插件
</code></pre></div><p>npm i optimize-css-assets-webpack-plugin -S
const OptimizeCSSAssetsPlugin = require(&quot;optimize-css-assets-webpack-plugin&quot;)
optimization: {
minimizer: [
new OptimizeCSSAssetsPlugin({})
]
},
// 就不必在plugins数组中实例化该插件了</p> <div class="language- extra-class"><pre class="language-text"><code>- 如果对于多个入口文件的打包，希望把所有入口文件中引入的css文件，都打包到dist文件夹下的同一个css文件中，需要再配置optimization下的splitChunks，optimize-css-assets-webpack-plugin插件的底层也是依赖splitChunks,需要在添加一个styles组，对打包生成的css文件做处理
</code></pre></div><p>optimization: {
splitChunks: {
cacheGroups: {
styles: {
name: 'styles',
test: /.css$/,
chunks: 'all',
enforce: true
}
}
}
},</p> <div class="language- extra-class"><pre class="language-text"><code>- 如果对于多个入口文件的打包，希望把每个入口文件中引入的css文件都单独打包到dist文件夹下的不同的css文件中,还是配置splitChunks,需要在添加各自对应的组
</code></pre></div><p>optimization: {
splitChunks: {
cacheGroups: {
fooStyles: {
name: 'foo',
test: (m,c,entry = 'foo') =&gt; m.constructor.name === 'CssModule' &amp;&amp; recursiveIssuer(m) === entry,
chunks: 'all',
enforce: true
},
barStyles: {
name: 'bar',
test: (m,c,entry = 'bar') =&gt; m.constructor.name === 'CssModule' &amp;&amp; recursiveIssuer(m) === entry,
chunks: 'all',
enforce: true
}
}
}
},</p> <div class="language- extra-class"><pre class="language-text"><code>## webpack与浏览器缓存(Caching)
- performance: false, 取消对性能提示的警告
- 使用contentHash占位符，解决浏览器缓存导致无法更新服务器静态资源的问题
- 当我们重新打包上线时，用户只需要更新有变化的代码，没有变化的代码，用户可以直接用他们本地浏览器的缓存
- contenthash是根据content产生的一个hash字符串，内容不变，hash字符串也不变，内容变了，hash字符串才变
- 在开发环境，实时重载和热模块更新会帮助我们解决缓存的问题，而在生产环境，我们就要借助contenthash占位符，帮助我们解决浏览器缓存的问题
</code></pre></div><p>// 只需在生产环境只配置
output:{
filename: '[name].[contenthash].js',
chunkFilename: '[name].[contenthash].js'
},</p> <div class="language- extra-class"><pre class="language-text"><code>- 对于老版本webpack，在使用了contenthash后，即便没有对代码做修改，打包后生成的contenthash也会发生变化，需要再加一些额外的配置，
- 在webpack.common.js中的optimization中添加runtimeChunk,新版本中也是可以配置该参数的，这样，在最终打包生成的代码中将会多一个runtime.contenthash.js的文件， 
- 在做webpack打包时，main.js放的是业务逻辑，vendors.js放的是第三方库文件，而业务逻辑与第三方库文件之间是一些关联，这些关联代码被称为manifest，它默认存在于main.js，也存在于vendors.js，当再次打包时，这些关联代码可能会发生改变，所以contenthash也变了，而runtime.contenthash.js文件就是把manifest文件单独抽取出来了，所以之后如果业务逻辑和库文件代码如果没有修改，则对应的contenthash也就不会发生变化，发生变化的只有runtime.contenthash.js中的contenthash，此外老版本webpack做缓存还要借助一些其他插件，建议直接升级新版本
</code></pre></div><p>optimization: {
runtimeChunk: {
name: 'runtime '
}
}</p> <div class="language- extra-class"><pre class="language-text"><code>## Shimming的作用
- 在webpack打包过程中，我们往往要做一些代码上的兼容或者打包过程的兼容 
- 例如@babel/polyfill它解决的是 ，我们打包生成的JS代码运行在低版本浏览器时，有时会因为低版本浏览器上不存在Promise变量导致我们的代码无法运行， 借助它，在低版本浏览器上自动的帮我们去构建一些类似Promise这样的全局变量，从而使我们的代码可以在低版本浏览器上运行，其实这就是一个webpack的垫片，它能够解决webpack打包过程中的一些兼容性问题，当然这种兼容性问题不局限在浏览器的高低版本间，还有一些其他方面
- 这些可以修改webpack默认行为的兼容都可以称之为垫片
-  可以自动向新的npm模块中引入jquery，解决有时候我们无法手动添加一些老版本库文件的问题
</code></pre></div><p>new  webpack.ProvidePlugin({
$: 'jquery',
_: 'lodash ',
_join: ['lodash ', 'join']
})</p> <div class="language- extra-class"><pre class="language-text"><code>-  一个js模块中的this, 默认永远指向模块自身，而不是window，如果希望将每个模块中的this都指向window,可以借助imports-loader 来对this指向做变更
</code></pre></div><p>npm i imports-loader -S
rules: [
{
test: '/.js$/',
exclude: /(node_modules|bower_components)/,
use: [
{ loader: 'babel-loader'},
{
loader: 'imports-loader?this=&gt;window'
}
]
}}</p> <div class="language- extra-class"><pre class="language-text"><code>## 环境变量的使用
- env</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/sunnyzlx/personal_learning_blog/edit/master/docs/webpack/webpack高级.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/personal_learning_blog/webpack/webpack进阶.html" class="prev">
        webpack进阶
      </a></span> <span class="next"><a href="/personal_learning_blog/webpack/webpack实战.html">
        webpack实战
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/personal_learning_blog/assets/js/app.74e3015b.js" defer></script><script src="/personal_learning_blog/assets/js/2.6c17bd23.js" defer></script><script src="/personal_learning_blog/assets/js/89.86e0154c.js" defer></script>
  </body>
</html>
